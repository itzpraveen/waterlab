{% extends 'core/base.html' %}
{% load core_extras %}

{% block title %}Front Desk Dashboard - Water Lab LIMS{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="page-heading">
        <h1 class="page-title">Front desk dashboard</h1>
        <p class="page-subtitle">Manage customer intake, register samples, and track report readiness in one place.</p>
    </div>
    <div class="badge-soft primary">
        <i class="material-icons">support_agent</i>
        {{ user.get_role_display }}
    </div>
</div>
{% endblock %}

{% block content %}
<section class="stat-grid mb-4">
    <a class="stat-card stat-card--link" href="{% url 'core:customer_list' %}">
        <div class="stat-icon"><i class="material-icons">groups</i></div>
        <div class="stat-value">{{ total_customers }}</div>
        <p class="stat-label mb-0">Total customers</p>
    </a>
    <a class="stat-card stat-card--link" href="{% url 'core:sample_list' %}?status=RECEIVED_FRONT_DESK">
        <div class="stat-icon"><i class="material-icons">hourglass_empty</i></div>
        <div class="stat-value">{{ pending_samples }}</div>
        <p class="stat-label mb-0">Pending check-in</p>
    </a>
    <a class="stat-card stat-card--link" href="{% url 'core:sample_list' %}?collected=today">
        <div class="stat-icon"><i class="material-icons">today</i></div>
        <div class="stat-value">{{ today_samples }}</div>
        <p class="stat-label mb-0">Today's samples</p>
    </a>
    <a class="stat-card stat-card--link" href="{% url 'core:sample_list' %}?status=REPORT_APPROVED">
        <div class="stat-icon"><i class="material-icons">task_alt</i></div>
        <div class="stat-value">{{ ready_reports }}</div>
        <p class="stat-label mb-0">Ready reports</p>
    </a>
    <div class="stat-card">
        <div class="stat-icon"><i class="material-icons">trending_up</i></div>
        <div class="stat-value">{{ week_samples }}</div>
        <p class="stat-label mb-0">Samples in last 7 days</p>
    </div>
</section>

<section class="info-card mb-4">
    <div class="section-title"><i class="material-icons">flash_on</i>Quick actions</div>
    <div class="quick-link-bar">
        <a href="{% url 'core:customer_add' %}" class="action-chip action-chip--primary">
            <i class="material-icons">person_add</i>
            Register customer
        </a>
        <a href="{% url 'core:sample_add' %}" class="action-chip action-chip--primary">
            <i class="material-icons">colorize</i>
            Register sample
        </a>
        <a href="{% url 'core:sample_list' %}?status=REPORT_APPROVED" class="action-chip">
            <i class="material-icons">outbox</i>
            Share ready reports
        </a>
        <a href="{% url 'core:sample_list' %}" class="action-chip">
            <i class="material-icons">inventory</i>
            Manage samples
        </a>
    </div>
</section>

<div class="row g-4">
    <div class="col-12 col-xl-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">group</i>Recent customers</div>
            {% if recent_customers %}
            <div class="list-group list-group-flush">
                {% for customer in recent_customers %}
                <div class="list-group-item d-flex flex-column gap-2">
                    <div class="d-flex justify-content-between align-items-start gap-3">
                        <a href="{% url 'core:customer_detail' customer.pk %}" class="fw-semibold text-decoration-none">
                            {{ customer.name }}
                        </a>
                        <a href="{% url 'core:sample_add' %}?customer={{ customer.pk }}" class="btn btn-sm btn-outline-primary">Add sample</a>
                    </div>
                    <div class="text-muted small">
                        {% if customer.email %}{{ customer.email }}{% endif %}
                        {% if customer.phone %}{% if customer.email %} Â· {% endif %}{{ customer.phone }}{% endif %}
                    </div>
                    {% if customer.village_town_city %}
                    <div class="text-muted small">
                        {{ customer.village_town_city }}{% if customer.get_district_display %}, {{ customer.get_district_display }}{% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="material-icons">person_search</i>
                <p class="mb-0">No customers yet. Start by registering your first customer.</p>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="col-12 col-xl-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">assessment</i>Sample status overview</div>
            {% if samples_by_status %}
            <ul class="list-group list-group-flush">
                {% for status in samples_by_status %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="text-muted">{{ status.current_status|replace:"_, "|title }}</span>
                    <span class="badge bg-secondary-subtle text-secondary-emphasis">{{ status.count }}</span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-muted mb-0">Sample activity will appear here once registrations begin.</p>
            {% endif %}
        </div>
    </div>
</div>

<section class="info-card mt-4">
    <div class="section-title"><i class="material-icons">view_list</i>Recent sample registrations</div>
    {% if recent_samples %}
    <div class="table-responsive card-table">
        <table class="table table-sm align-middle mb-0">
            <thead>
                <tr>
                    <th>Sample</th>
                    <th>Customer</th>
                    <th>Collected</th>
                    <th>Status</th>
                    <th class="text-end"></th>
                </tr>
            </thead>
            <tbody>
                {% for sample in recent_samples %}
                <tr>
                    <td>{{ sample.sample_id }}</td>
                    <td>{{ sample.customer.name }}</td>
                    <td>{{ sample.collection_datetime|date:"M d, Y H:i" }}</td>
                    <td>
                        <span class="badge bg-info-subtle text-info-emphasis">{{ sample.get_current_status_display }}</span>
                    </td>
                    <td class="text-end">
                        <a href="{% url 'core:sample_detail' sample.pk %}" class="btn btn-sm btn-outline-secondary">Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="material-icons">inventory_2</i>
        <p class="mb-0">Recent sample registrations will appear here.</p>
    </div>
    {% endif %}
</section>

<div class="row g-4 mt-1">
    <div class="col-12 col-lg-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">timeline</i>Weekly progress</div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="text-muted">New customers (recent batch)</span>
                    <span class="fw-semibold">{{ week_customers }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="text-muted">Samples registered (7 days)</span>
                    <span class="fw-semibold">{{ week_samples }}</span>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-12 col-lg-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">help_outline</i>Need anything else?</div>
            <p class="text-muted mb-3">Keep the lab updated by logging new samples promptly and reminding consultants when reports are ready.</p>
            <div class="d-flex flex-wrap gap-2">
                <a href="{% url 'core:customer_list' %}" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">contacts</i>Customer directory</a>
                <a href="{% url 'core:sample_list' %}?status=REPORT_APPROVED" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">share</i>Hand over reports</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
