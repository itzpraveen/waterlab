{% extends 'core/base.html' %}
{% load static %}

{% block title %}Customers - Water Lab LIMS{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="page-heading">
        <h1 class="page-title">Customer directory</h1>
        <p class="page-subtitle">Manage customer profiles and launch new sample requests.</p>
    </div>
    {% if user.is_frontdesk or user.is_admin %}
    <a href="{% url 'core:customer_add' %}" class="btn btn-primary"><i class="material-icons me-1">person_add</i>Add customer</a>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="info-card mb-4">
    <label for="customer-search" class="form-label">Search customers</label>
    <div class="input-group">
        <span class="input-group-text"><i class="material-icons">search</i></span>
        <input type="text" id="customer-search" class="form-control" placeholder="Search by name, email, or phone"
               data-table-search="#customer-table"
               data-empty-state="#no-customers-state">
    </div>
</div>

<div data-table-wrapper class="card-table{% if not customers %} d-none{% endif %}">
    <div class="table-responsive">
        <table class="table align-middle" id="customer-table">
            <thead>
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">District</th>
                    <th scope="col" class="text-center">Samples</th>
                    <th scope="col" class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center gap-2">
                            <span class="table-avatar">{{ customer.name|first|upper }}</span>
                            <a href="{% url 'core:customer_detail' pk=customer.customer_id %}" class="fw-semibold text-decoration-none">{{ customer.name }}</a>
                        </div>
                    </td>
                    <td>
                        {% if customer.email %}
                        <a href="mailto:{{ customer.email }}" class="text-decoration-none">{{ customer.email }}</a>
                        {% else %}
                        <span class="text-muted">Not provided</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if customer.phone %}
                        <a href="tel:{{ customer.phone }}" class="text-decoration-none">{{ customer.phone }}</a>
                        {% else %}
                        <span class="text-muted">Not provided</span>
                        {% endif %}
                    </td>
                    <td><span class="chip-soft">{{ customer.get_district_display }}</span></td>
                    <td class="text-center">{{ customer.samples.count }}</td>
                    <td class="text-end">
                        <div class="btn-group" role="group">
                            <a href="{% url 'core:customer_detail' pk=customer.customer_id %}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="View">
                                <i class="material-icons">visibility</i>
                            </a>
                            {% if user.is_frontdesk or user.is_admin %}
                            <a href="{% url 'core:customer_edit' pk=customer.customer_id %}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Edit">
                                <i class="material-icons">edit</i>
                            </a>
                            <a href="{% url 'core:sample_add' %}?customer={{ customer.customer_id }}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Register sample">
                                <i class="material-icons">colorize</i>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="no-customers-state" class="empty-state{% if customers %} d-none{% endif %}">
    <i class="material-icons">people_outline</i>
    <h5 class="fw-semibold">No customers yet</h5>
    <p class="text-muted">Add your first customer to start tracking samples and reports.</p>
    {% if user.is_frontdesk or user.is_admin %}
    <a href="{% url 'core:customer_add' %}" class="btn btn-primary btn-sm"><i class="material-icons me-1">person_add</i>Add customer</a>
    {% endif %}
</div>
{% endblock %}
