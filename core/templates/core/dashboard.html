{% extends 'core/base.html' %}

{% block title %}Dashboard - Water Lab LIMS{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="page-heading">
        <h1 class="page-title">Administrator Dashboard</h1>
        <p class="page-subtitle">Keep track of customer onboarding, sample testing progress, and reporting workflows.</p>
    </div>
    <div class="badge-soft success">
        <i class="material-icons">verified_user</i>
        Welcome {{ user.first_name|default:user.username }}
    </div>
</div>
{% endblock %}

{% block content %}
<section class="stat-grid mb-4">
    <div class="stat-card">
        <div class="stat-icon"><i class="material-icons">people</i></div>
        <div class="stat-value">{{ total_customers|default:0 }}</div>
        <p class="stat-label mb-0">Total Customers</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="material-icons">science</i></div>
        <div class="stat-value">{{ total_samples|default:0 }}</div>
        <p class="stat-label mb-0">Total Samples</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="material-icons">hourglass_top</i></div>
        <div class="stat-value">{{ pending_samples|default:0 }}</div>
        <p class="stat-label mb-0">Pending Samples</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="material-icons">task_alt</i></div>
        <div class="stat-value">{{ completed_samples|default:0 }}</div>
        <p class="stat-label mb-0">Completed</p>
    </div>
</section>

<section class="info-card mb-4">
    <div class="section-title">
        <i class="material-icons">flash_on</i>
        Quick actions
    </div>
    <p class="text-muted mb-3">Move directly into the tasks you handle most.</p>
    <div class="quick-link-bar">
        {% if user.is_frontdesk or user.is_admin %}
        <a href="{% url 'core:customer_add' %}" class="btn btn-primary btn-sm"><i class="material-icons me-1">person_add</i>Add customer</a>
        {% endif %}
        {% if user.is_frontdesk or user.is_admin %}
        <a href="{% url 'core:sample_add' %}" class="btn btn-outline-primary btn-sm"><i class="material-icons me-1">note_add</i>Register sample</a>
        {% endif %}
        {% if user.is_frontdesk or user.is_admin or user.is_lab_technician or user.is_consultant %}
        <a href="{% url 'core:customer_list' %}" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">contacts</i>View customers</a>
        <a href="{% url 'core:sample_list' %}" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">inventory</i>View samples</a>
        {% endif %}
        {% if user.is_lab_technician or user.is_admin %}
        <a href="{% url 'core:test_result_list' %}" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">fact_check</i>Enter results</a>
        {% endif %}
        {% if user.is_admin %}
        <a href="{% url 'core:audit_trail' %}" class="btn btn-outline-secondary btn-sm"><i class="material-icons me-1">history</i>Audit trail</a>
        {% endif %}
    </div>
</section>

<div class="row g-4">
    <div class="col-lg-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">badge</i>Your access profile</div>
            <dl class="row mb-0 small">
                <dt class="col-5 text-muted">Role</dt>
                <dd class="col-7 mb-2">{{ user.get_role_display|default:"Standard User" }}</dd>
                {% if user.department %}
                <dt class="col-5 text-muted">Department</dt>
                <dd class="col-7 mb-2">{{ user.department }}</dd>
                {% endif %}
                <dt class="col-5 text-muted">Permissions</dt>
                <dd class="col-7 mb-2">
                    {% if user.is_admin %}Administrator{% elif user.is_staff %}Staff{% else %}Standard user{% endif %}
                </dd>
                <dt class="col-5 text-muted">Last login</dt>
                <dd class="col-7 mb-0">{{ user.last_login|date:"M d, Y H:i"|default:"N/A" }}</dd>
            </dl>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="info-card h-100">
            <div class="section-title"><i class="material-icons">info</i>System status</div>
            <dl class="row mb-0 small">
                <dt class="col-5 text-muted">Lab name</dt>
                <dd class="col-7 mb-2">WaterLab LIMS by Biofix</dd>
                <dt class="col-5 text-muted">Location</dt>
                <dd class="col-7 mb-2">Kerala, India</dd>
                <dt class="col-5 text-muted">Version</dt>
                <dd class="col-7 mb-2">1.0.0</dd>
                <dt class="col-5 text-muted">Accreditation</dt>
                <dd class="col-7 mb-2">NABL compliant</dd>
                <dt class="col-5 text-muted">Support</dt>
                <dd class="col-7 mb-0"><a href="mailto:support@biofix.in">support@biofix.in</a></dd>
            </dl>
        </div>
    </div>
</div>

{% if not user.role or user.role == 'CUSTOMER' %}
<section class="info-card mt-4 text-center">
    <div class="section-title justify-content-center"><i class="material-icons">contact_support</i>Need assistance?</div>
    <p class="mb-2">For additional permissions or guidance, reach out to your system administrator or the support team.</p>
    {% if not user.is_authenticated %}
    <a href="{% url 'core:login' %}" class="btn btn-primary btn-sm"><i class="material-icons me-1">login</i>Login to view samples</a>
    {% else %}
    <a href="{% url 'core:sample_list' %}" class="btn btn-outline-primary btn-sm"><i class="material-icons me-1">science</i>View my samples</a>
    {% endif %}
</section>
{% endif %}
{% endblock %}
